@model List<HqCatalog.Business.Models.Hq>

@{
    ViewData["Title"] = "Catálogo de HQs";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Catálogo de HQs</h2>

        <!-- Barra de pesquisa com tamanho correto -->
        <div class="search-container">
            <div class="input-group">
                <input type="text" id="searchInput" class="form-control search-input" placeholder="Pesquisar HQs...">
                <button class="btn btn-primary search-button" id="searchButton">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>

        <!-- Botão de adicionar HQ -->
        <a href="@Url.Action("Create", "Hq", new { area = "Site" })" class="btn btn-success add-hq-button">
            + Adicionar HQ
        </a>
    </div>

    <div class="row">
        <!-- Sidebar de Filtros -->
        <div class="col-md-3">
            <div class="filter-sidebar">
                <h4><strong>Filtros</strong></h4>
                <hr>
                <h5>Editora</h5>
                <div id="editora-filtros">
                    @foreach (var editora in Model.Select(hq => hq.Editora).Distinct().ToList())
                    {
                        <label>
                            <input type="checkbox" class="filter-checkbox" data-filter="editora" value="@editora"> @editora
                        </label>
                        <br>
                    }
                </div>
                <h5>Gênero</h5>
                <div id="genero-filtros">
                    @foreach (var genero in Model.Select(hq => hq.Genero).Distinct().ToList())
                    {
                        <label>
                            <input type="checkbox" class="filter-checkbox" data-filter="genero" value="@genero"> @genero
                        </label>
                        <br>
                    }
                </div>
            </div>
        </div>

        <!-- Lista de HQs -->
        <div class="col-md-9">
            <div class="row" id="hq-list">
                @foreach (var hq in Model.ToList())
                {
                    <partial name="_HqCard" model="hq" />
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.getElementById("searchInput");
            const searchButton = document.getElementById("searchButton");

            function fetchHqs(query) {
                fetch(`/Site/Home/SearchHqs?query=${encodeURIComponent(query)}`)
                    .then(response => response.json())
                    .then(data => {
                        const hqList = document.getElementById("hq-list");
                        hqList.innerHTML = ""; // Limpa os HQs antes de exibir os novos

                        data.forEach(hq => {
                            hqList.innerHTML += `
                                <div class="col-lg-4 col-md-6 col-sm-12 d-flex align-items-stretch hq-item">
                                    <div class="hq-card text-center shadow-sm">
                                        <div class="hq-editora-bubble" style="background-color: ${hq.editoraCor}">
                                            <span>${hq.editora}</span>
                                        </div>
                                        <img src="/imagens/hqs/${hq.imagemUrl}" class="hq-image" alt="${hq.titulo}">
                                        <div class="hq-info">
                                            <h5 class="hq-title">${hq.titulo}</h5>
                                            <p class="hq-description">${hq.sinopse}</p>
                                            <a href="/Site/Hq/Detalhes/${hq.id}" class="hq-button" style="background-color: ${hq.editoraCor}">
                                                Descubra Agora
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    })
                    .catch(error => console.error("Erro ao buscar HQs:", error));
            }

            searchButton.addEventListener("click", function () {
                fetchHqs(searchInput.value);
            });

            searchInput.addEventListener("keyup", function (event) {
                if (event.key === "Enter") {
                    fetchHqs(searchInput.value);
                }
            });
        });
    </script>
}
